{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "padding": {
        "top": 20,
        "left": 5,
        "right": 5,
        "bottom": 5
    },
    "description": "A donut chart of the city loop stations",
    "width": 850,
    "height": 400,
    "data": {
        "url": "https://raw.githubusercontent.com/JhonnyMonash/Viz2/refs/heads/main/data/City_Loop_Stations.csv",
        "format": {
            "type": "csv"
        }
    },
    "transform": [
        {
            "window": [
                {
                    "op": "sum",
                    "field": "PAX",
                    "as": "TotalValue"
                }
            ],
            "frame": [
                null,
                null
            ]
        },
        {
            "calculate": "datum.PAX / datum.TotalValue * 100",
            "as": "Percentage"
        },
        {
            "calculate": "datum.Station + ' (' + format(datum.Percentage, '.1f') + '%)'",
            "as": "LabelWithPercentage"
        }
    ],
    "encoding": {
        "theta": {
            "field": "PAX",
            "type": "quantitative",
            "stack" : true
        },
        "color": {
            "field": "Station",
            "type": "nominal",
            "scale":{"domain":[
                "Flinders Street",
                "Southern Cross",
                "Parliament",
                "Melbourne Central",
                "Flagstaff"
            ],
            "range":[
                "#8BC1F7",
                "#519DE9",
                "#06C",
                "#004B95",
                "#002F5D"
            ]},
            "legend" : null
        },
        "order" :{"field":"PAX","type": "quantitative","sort": "descending"},
        "tooltip":[
            {
                "field": "Station",
                "type": "nominal",
                "title": "Station Name"
            },
            {
                "field": "Percentage",
                "type": "quantitative",
                "title": "Percentage of total(%)",
                "format": ".1f"
            },
            {
                "field": "PAX",
                "type": "quantitative",
                "title": "Number of Passengers",
                "format": ",d"
            }
        ]
    },
    "layer": [
        {"mark":{"type": "arc","outerRadius":170}},
        {
        "mark": {"type": "text", "radius": 230, "fontSize": 14},
        "encoding": {"text": {"field": "LabelWithPercentage"}}
        }
    ]
}