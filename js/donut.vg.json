{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "padding": {
        "top": 20,
        "left": 5,
        "right": 5,
        "bottom": 5
    },
    "description": "A donut chart of the city loop stations",
    "width": 850,
    "height": 400,
    "data": {
        "url": "https://raw.githubusercontent.com/JhonnyMonash/Viz2/refs/heads/main/data/City_Loop_Stations.csv",
        "format": {
            "type": "csv"
        }
    },
    "transform": [
        {
            "window": [
                {
                    "op": "sum",
                    "field": "PAX",
                    "as": "TotalValue"
                }
            ],
            "frame": [
                null,
                null
            ]
        },
        {
            "calculate": "datum.PAX / datum.TotalValue * 100",
            "as": "Percentage"
        },
        {
            "calculate": "datum.Station + '(' + format(datum.Percentage, '.2f') + '%)'",
            "as": "LabelWithPercentage"
        }
    ],
    "encoding": {
        "theta": {
            "field": "PAX",
            "type": "quantitative",
            "stack" : true
        },
        "color": {
            "field": "Station",
            "type": "nominal",
            "scale":{"domain":[
                "Flinders Street  ",
                "Southern Cross",
                "Parliament ",
                "Melbourne Central",
                "Flagstaff"
            ],
            "range":[
                "#4B4B4B",
                "#FFAA00",
                "#1F78B4",
                "#6DBE45",
                "#FFD700"
            ]},
            "legend" : null
        },
        "tooltip":[
            {
                "field": "Station",
                "type": "nominal",
                "title": "Station Name"
            },
            {
                "field": "Percentage",
                "type": "quantitative",
                "title": "Percentage of total(%)",
                "format": ".2f"
            }
        ]
    },
    "layer": [
        {"mark":{"type": "arc","outerRadius":170}},
        {
        "mark": {"type": "text", "radius": 220, "fontSize": 12},
        "encoding": {"text": {"field": "LabelWithPercentage"}}
        }
    ]
}